<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>ENI-Enchères</title>
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />
    <link rel="stylesheet" th:href="@{/css/pagination.css}" />
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="stylesheet" th:href="@{/css/encheres.css}" />
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link rel="stylesheet" th:href="@{/css/footer.css}" />
  </head>

  <body>
    <div class="app-container">
      <!-- Header -->
      <div th:replace="~{fragments/header :: header}"></div>

      <h2 th:text="#{encheres.titre}">Liste des enchères</h2>

      <!-- Formulaire de recherche unifié -->
      <div class="search-container">
        <form th:action="@{/encheres}" method="get" class="unified-search-form">
          <div class="unified-search-wrapper">
            <input
              type="text"
              name="nomArticle"
              th:value="${nomArticle}"
              placeholder="Que recherchez-vous ?"
              class="unified-search-input"
            />

            <div class="search-divider"></div>

            <select name="categorieId" class="unified-search-select">
              <option value="0">Toutes catégories</option>
              <option
                th:each="categorie : ${categories}"
                th:value="${categorie.noCategorie}"
                th:text="${categorie.libelle}"
                th:selected="${categorieId != null && categorieId == categorie.noCategorie}"
              >
                Nom de la catégorie
              </option>
            </select>
            <button type="submit" class="unified-search-button">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </button>
          </div>
        </form>
      </div>

      <!-- Message d'erreur -->
      <div th:if="${message}" class="message" th:text="${message}">
        Message d'erreur
      </div>

      <!-- Liste des enchères -->
      <div th:if="${encheres != null}" class="encheres-liste">
        <div
          th:each="enchere : ${encheres}"
          class="enchere"
          th:if="${enchere != null && enchere.articleCible != null}"
        >
          <div class="enchere-details">
            <div class="enchere-image"><div>X</div></div>
            <div class="enchere-info">
              <a
                th:href="@{'/article/' + ${enchere.articleCible.noArticle}}"
                th:text="${enchere.articleCible.nomArticle ?: 'Article sans nom'}"
                class="enchere-nom"
                >Nom de l'article</a
              >

              <div class="enchere-prix">
                <span th:text="#{encheres.article.prix}">Prix :</span>
                <span
                  th:text="${enchere.montant_enchere != null ? enchere.montant_enchere : 0}"
                ></span>
                points
              </div>

              <div class="enchere-fin">
                <span th:text="#{encheres.article.fin}"
                  >Fin de l'enchère :</span
                >
                <span
                  th:text="${enchere.dateEnchere != null ? #temporals.format(enchere.dateEnchere, 'dd/MM/yyyy') : 'Non définie'}"
                  >01/01/2023</span
                >
              </div>

              <div class="enchere-vendeur" th:if="${article.vendeur != null}">
                Vendeur :
                <a
                  th:href="@{'/utilisateurs/' + ${article.vendeur.pseudo}}"
                  th:text="${article.vendeur.pseudo}"
                  >vendeur</a
                >
              </div>
            </div>
          </div>
        </div>

        <div th:if="${encheres.empty}" class="enchere">
          <div class="message" th:text="#{encheres.vide}">
            Aucune enchère n'est disponible pour le moment.
          </div>
        </div>
      </div>

      <div
        th:if="${encheres == null}"
        class="message"
        th:text="#{encheres.erreur}"
      >
        Erreur lors du chargement des enchères.
      </div>

      <!-- Informations utilisateur -->
      <div class="user-info">
        <div th:if="${utilisateurConnecte != null}">
          <div
            th:text="${utilisateurConnecte.pseudo} + ' ' + #{encheres.connecte}"
          ></div>
        </div>
        <div th:unless="${utilisateurConnecte != null}">
          <div th:text="#{encheres.nonconnecte}">Vous n'êtes pas connecté</div>
          <div>
            <a th:href="@{/login}" th:text="#{encheres.connexion}"
              >Se connecter</a
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const toggleButton = document.getElementById("toggleOptions");
        const optionsPanel = document.getElementById("optionsPanel");

        if (toggleButton && optionsPanel) {
          toggleButton.addEventListener("click", function () {
            optionsPanel.classList.toggle("show");
            toggleButton.classList.toggle("active");
          });
        }

        const achatsRadio = document.getElementById("achats");
        const ventesRadio = document.getElementById("ventes");
        const achatsCheckboxes = document.querySelectorAll(
          "#encheresOuvertes, #mesEncheresEnCours, #mesEncheresRemportees"
        );
        const ventesCheckboxes = document.querySelectorAll(
          "#mesVentesEnCours, #ventesNonDebutees, #ventesTerminees"
        );

        if (achatsRadio && ventesRadio) {
          achatsRadio.addEventListener("change", function () {
            if (this.checked) {
              achatsCheckboxes.forEach((c) => (c.disabled = false));
              ventesCheckboxes.forEach((c) => {
                c.disabled = true;
                c.checked = false;
              });
            }
          });

          ventesRadio.addEventListener("change", function () {
            if (this.checked) {
              ventesCheckboxes.forEach((c) => (c.disabled = false));
              achatsCheckboxes.forEach((c) => {
                c.disabled = true;
                c.checked = false;
              });
            }
          });

          if (achatsRadio.checked) {
            ventesCheckboxes.forEach((c) => (c.disabled = true));
          } else if (ventesRadio.checked) {
            achatsCheckboxes.forEach((c) => (c.disabled = true));
          }
        }
      });
    </script>
    <<<<<<< HEAD ======= >>>>>>> 22ff445717ade9516957270b75755551b50a645f
  </body>
</html>
